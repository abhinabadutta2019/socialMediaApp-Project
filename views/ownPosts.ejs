<%- include('partials/header') %>
<h2>Your own posts</h2>
<div>
  <% if ( myArray.length>0) { %>
  <!--  -->
  <% for( let index = 0; index < myArray.length; index++ ) { %>

  <li id="<%=myArray[index]._id %>">
    <% if (myArray[index].photoPath) { %>
    <div>
      <img
        src="<%= myArray[index].photoPath %>"
        alt="image"
        width="200"
        height="150"
      />
    </div>
    <% } %>
    <p>description : <%=myArray[index].description %></p>
    <p>likes : <%=myArray[index].likes.length %></p>
    <!--  -->
    <div>
      <button class="btn btn-primary" onclick="postLikedByButton()">
        postLikedBy
      </button>
    </div>
    <!--  -->
    <br />
    <!--  -->
    <div>
      <button
        class="btn btn-primary"
        onclick="updatePostButton('<%=myArray[index]._id%>')"
      >
        updatePost
      </button>
    </div>
    <!--  -->
    <br />
    <button class="btn btn-danger" onclick="deletePost()">DeletePost</button>
  </li>

  <% } %>
  <!--  -->
  <% } else{%>
  <p>No post created by user</p>
  <%}%>
</div>
<script>
  async function updatePostButton(post_id) {
    // console.log("Hy");
    // const postUpdateButton = event.target;
    // const postUpdateButtonParent = postUpdateButton.parentElement;
    // const postUpdateButtonGrandParent = postUpdateButtonParent.parentElement;
    // const postUpdateButtonGPId = postUpdateButtonGrandParent.id;
    //
    // console.log(postUpdateButtonGPId, "postUpdateButtonGPId");
    //

    // console.log(post_id, "post_id");
    window.location.href = `${window.location.origin}/post/update/${post_id}`;
  }
  //
  async function postLikedByButton() {
    //
    try {
      //
      const postLikedButton = event.target;
      const postLikedButtonParent = postLikedButton.parentElement;
      const postLikedButtonGrandParent = postLikedButtonParent.parentElement;
      //
      const postLikedButtonGPId = postLikedButtonGrandParent.id;
      //
      // console.log(postLikedButtonGPId, "postLikedButtonGPId");

      //redirect
      window.location.href = `${window.location.origin}/post/postLiked/${postLikedButtonGPId}`;
      //
    } catch (err) {
      console.log(err);
    }
  }
  //
  async function deletePost() {
    //
    try {
      const deleteButton = event.target;
      const deleteButtonParent = deleteButton.parentElement;
      const deleteParentId = deleteButtonParent.id;
      // console.log(deleteParentId, "deleteParentId");

      const responseDelete = await fetch(
        `${window.location.origin}/post/delete/${deleteParentId}`,
        {
          method: "DELETE",
          headers: {
            "Content-Type": "application/json",
          },
        }
      );
      //
      const deleteResult = await responseDelete.json();

      console.log(deleteResult, "deleteResult");

      if (deleteResult.message == "post delete success") {
        setTimeout(function () {
          //redirect
          window.location.href = `${window.location.origin}/post/ownposts`;
        }, 1000);
      }

      // window.location.href = `${window.location.origin}/post/ownposts`;
    } catch (err) {
      console.log(err);
    }
  }
</script>

<%- include('partials/footer') %>
